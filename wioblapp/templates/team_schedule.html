{% extends 'base.html' %}
{% block 'title' %} {{request.user.username}}'s Account {% endblock %}
{% load static %}

{% block content %}

<section class="teams-search schedule">
    <div class="container">
        <form action="{% url 'team_schedule' team %}" method="POST">
            {% csrf_token %}

            <div class="section-heading">
                <h3>{{ team }} Schedule</h3>
            </div>

            <div class="search-form">
                <div class="search-flex">
                    <div class="label-flex">
                        <label for="month">Select {{ schedule_form.month.label }}</label>
                        {{ schedule_form.month }}
                    </div>
                    <div class="label-flex">
                        <label for="date">Order by {{ schedule_form.date.label }}</label>
                        {{ schedule_form.date }}
                    </div>
                    <div class="label-flex">
                        <label for="result">Order by Game {{ schedule_form.result.label }}</label>
                        {{ schedule_form.result }}
                    </div>
                </div>
            </div>
        </form>

        {% if games %}

        <div class="section-heading">
            <h3>Games</h3>
        </div>

        <table>
            <thead>
                <tr>
                    <!-- column 1 -->
                    <th>Date, Location</th>
                    <!-- column 2 -->
                    <th>Team1</th>
                    <!-- column 3 -->
                    <th>Team2</th>
                </tr>
            </thead>

            <tbody>
                <!-- Game Content START-->
                {% for game in game_comments %}

                    <!-- GAME INFO ROW START -->
                    <tr class="game-row">
                        <!-- COLUMN 1 -->
                        <td>{{ game.game.date_time }} at {{ game.game.park }}</td>
                       
                        {% if game.game.team1_score and game.game.team2_score %}
                            <!-- COLUMN 2 -->
                            <td>{{ game.game.team_1.color }} {{ game.game.team_1 }}: {{ game.game.team1_score }}</td>
                            <!-- COLUMN 3 -->
                            <td>{{ game.game.team_2.color }} {{ game.game.team_2 }}: {{ game.game.team2_score }}</td>
                        {% else %}
                            <!-- COLUMN 2 -->
                            <td>{{ game.game.team_1 }}</td>
                            <!-- COLUMN 3 -->
                            <td>{{ game.game.team_2 }}</td>
                        {% endif %} 
                    </tr> <!-- GAME INFO ROW END -->
                    
                    <!-- COMMENT ROW START -->
                    <tr class="comment-row">
                        <td colspan="3">
                            <details class="comments-section">
                                <summary>Comment</summary>
                                <div>                                    
                                    <!-- Post a comment -->
                                    <form action="{% url 'create_comment' team %}" method="POST">
                                        {% csrf_token %}
                                        
                                        <div class="comment-flex">
                                            {% for field in comment_form %}
                                                {{ field }}
                                            {% endfor %}

                                            <button class="button blue-button" type="submit" name="post" value="{{ game.game.id }}">Send</button>                 
                                        </div>
    
                                    </form> <!-- Post a comment END -->

                                    <!-- See comments START -->
                                    <div>
                                        <h6>Comments</h6>
                                        {% if game.comments %}
                                            {% for comment in game.comments %} 
                                                {% if comment.game == game.game  %}

                                                    <!-- single comment START -->
                                                    <div>
                                                        <div class="comment comment-info">
                                                            <div class="comment-infoflex">
                                                                <p class="comment-txt">{{ comment.content }}</p>
                                                                <p class="date">{{ comment.date }}</p>
                                                            </div>
                                                        </div>

                                                        <div class="comment comment-actions">
                                                            <!-- Like count and like button -->
                                                            <form action="{% url 'like_comment' team %}" method="POST">
                                                                {% csrf_token %}

                                                                <p>Likes: {{ comment.likes }}</p>
                                                                <button type="submit" name="like" value="{{ comment.id }}"><i class="fa-solid fa-heart"></i></button>
                                                            </form>

                                                            <!-- Flag button -->
                                                            <form action="{% url 'flag_comment' team %}" method="POST">
                                                                {% csrf_token %}

                                                                <button type="submit" name="flag" value="{{ comment.id }}"><i class="fa-solid fa-flag"></i></button>
                                                            </form>

                                                            <!-- Edit own comment -->
                                                            {% if comment.user_account == request.user %}

                                                            <!-- 1. Edit button -->
                                                            <button>Edit</button>
                                                            <form action="{% url 'edit_comment' team comment.id %}" method="POST">
                                                                {% csrf_token %}
                                            
                                                                {% for field in comment_form %}
                                                                    {% if field.name == "content" %}
                                                                        <textarea name="{{ field.name }}" id="{{ field.id_for_label }}">{{ comment.content }}</textarea>
                                                                    {% else %}
                                                                        {{ field }}
                                                                    {% endif %}
                                                                {% endfor %}

                                                                <!-- 2. Submit edit button -->
                                                                <button type="submit" name="edit" value="{{ comment.id }}">Edit</button>
                                                            </form>
                                                            <form action="{% url 'delete_comment' team %}" method="POST">
                                                                {% csrf_token %}

                                                                <!-- Delete button -->
                                                                <button type="submit" name="delete" value="{{ comment.id }}"><i class="fa-solid fa-trash"></i></button>
                                                            </form>
                                                            {% endif %}
                                                        </div>
                                                    </div> <!-- single comment END -->

                                                {% endif %}
                                            {% endfor %}
                                        {% else %}
                                            <p>No comments related to this game</p>
                                        {% endif %} <!-- See comments END -->
                                    </div>

                                </div>
                            </details>
                        </td>
                    </tr> <!-- COMMENT ROW END -->

                {% endfor %} <!-- Game Content END-->
            </tbody>
        </table>

        {% else %}
            <p>No Games</p>
        {% endif %}

    </div>
</section>
{% endblock %}
